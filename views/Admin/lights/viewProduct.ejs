<%- include('../common/header'); -%> <%- include('../common/sidebar'); -%>

<style>
  .img-thumbnail {
    padding: 0.25rem;
    background-color: #f8f9fa;
    border: 1px solid #dee2e6;
    border-radius: 50%;
    max-width: 100%;
    height: 17rem;
    width: 18rem;
  }

  .new_lable {
    color: black;
    font-size: 13px;
    font-weight: 500;
  }

  ::-webkit-file-upload-button {
    display: none;
  }

  ::file-selector-button {
    display: none;
  }

  input[type="file"] {
    color: transparent;
  }

  .fe-24 {
    position: absolute;
    top: 292px;
    left: 268px;
    color: #ffffff;
    border: 2px solid #878181fc;
    border-radius: 50%;
    background: #000000c9;
  }

  .camera_icon {
    height: 3rem;
    width: 3rem;
    padding: 9px;
    display: inline-block;
  }
</style>

<body
  class="vertical-layout vertical-menu-modern navbar-floating footer-static"
  data-open="click"
  data-menu="vertical-menu-modern"
  data-col=""
>
  <!-- BEGIN: Content-->
  <div class="app-content content">
    <div class="content-overlay"></div>
    <div class="header-navbar-shadow"></div>
    <div class="content-wrapper container-xxl p-0">
      <div class="content-header row"></div>
      <div class="content-body">
        <section id="multiple-column-form">
          <div class="row">
            <div class="col-md-12 col-12">
              <div class="card">
                <div class="card-header">
                  <h4 class="card-title">Product View</h4>
                  <div style="display: flex; align-items: center; gap: 5px;">
                    <h4 style="margin-bottom: 0; ">Product Price History</h4>
                    <a href="/findupdatedPrice/<%= lightdetail._id %>" 
                      style="width: 50px; height: 40px; display: inline-flex; justify-content: center; align-items: center;" 
                      class="btn btn-sm bg-light-primary">
                      <i data-feather="eye"></i>
                    </a>
                  </div>
                  
                </div>
                <br />
                <div class="card-body">
                  <form
                    class="form form-horizontal"
                    action=""
                    method="POST"
                    id="profile"
                    enctype="multipart/form-data"
                  >
                    <div class="row">
                      <div class="col-md-12" style="margin-top: 17px">
                        <div class="col-md-4">
                          <div class="profile-widget-header text-center">
                            <img
                              src="<%=lightdetail.image%>"
                              id="output2"
                              alt="Profile Edit"
                              class="ms-md-0 mx-auto img-thumbnail user_bigimg"
                            />
                          </div>
                        </div>
                        <div class="mb-1 row">
                          <div class="col-sm-2">
                            <label
                              class="col-form-label new_lable"
                              for="categoryName"
                              >Category Name</label
                            >
                          </div>
                          <div class="col-sm-10">
                            <input
                              type="text"
                              id="categoryName"
                              class="form-control"
                              name="categoryNames"
                              value="<%= lightdetail.categoryNames?.categoryName %>"
                              maxlength="60"
                              readonly
                              required
                            />
                            <input
                              type="hidden"
                              name="id"
                              value="<%= lightdetail?._id %>"
                              required
                            />
                          </div>
                        </div>

                        <div class="mb-1 row">
                          <div class="col-sm-2">
                            <label
                              class="col-form-label new_lable"
                              for="productName"
                              >Product Name</label
                            >
                          </div>
                          <div class="col-sm-10">
                            <input
                              type="text"
                              id="productName"
                              class="form-control"
                              name="name"
                              value="<%= lightdetail.name %>"
                              maxlength="60"
                              readonly
                              required
                            />
                          </div>
                        </div>

                        <div class="mb-1 row">
                          <div class="col-sm-2">
                            <label
                              class="col-form-label new_lable"
                              for="productDescription"
                              >Product Description</label
                            >
                          </div>
                          <div class="col-sm-10">
                            <input
                              type="text"
                              id="productDescription"
                              class="form-control"
                              name="description"
                              value="<%= lightdetail.description ? lightdetail.description : 'Not specified' %>"
                              maxlength="60"
                              readonly
                              required
                            />
                          </div>
                        </div>

                        <div class="mb-1 row">
                          <div class="col-sm-2">
                            <label
                              class="col-form-label new_lable"
                              for="productDescription"
                              >Product Brand Name</label
                            >
                          </div>
                          <div class="col-sm-10">
                            <input
                              type="text"
                              id="productDescription"
                              class="form-control"
                              name="description"
                              value="<%= lightdetail.Brandname ? lightdetail.Brandname : 'Not specified' %>"
                              maxlength="60"
                              readonly
                              required
                            />
                          </div>
                        </div>
<!-- 
                        <div class="mb-1 row">
                          <div class="col-sm-2">
                            <label class="col-form-label new_lable" for="price"
                              >Price</label
                            >
                          </div>
                          <div class="input-group" style="width: 83%">
                            <span class="input-group-text" id="basic-addon1"
                              >$</span
                            >
                            <input
                              type="number"
                              id="price"
                              class="form-control"
                              name="price"
                              placeholder="Enter Price"
                              value="<%= lightdetail.price %>"
                              aria-describedby="basic-addon1"
                              readonly
                              required
                            />
                          </div>
                        </div> -->

                        <div class="mb-1 row">
                          <div class="col-sm-2">
                            <label
                              class="col-form-label new_lable"
                              for="productUnit"
                              >Product Unit</label
                            >
                          </div>
                          <div class="col-sm-10">
                            <input
                              type="text"
                              id="productUnit"
                              class="form-control"
                              name="productUnit"
                              value="<%= lightdetail.productUnitName  %>"
                              maxlength="60"
                              readonly
                              required
                            />
                          </div>
                        </div>
                        <div class="mb-1 row">
                          <div class="col-sm-2">
                            <label
                              class="col-form-label new_lable"
                              for="productUnit"
                              >BarCode</label
                            >
                          </div>
                          <div class="col-sm-10">
                            <input
                              type="text"
                              id="productUnit"
                              class="form-control"
                              name="BarCode"
                              value="<%= lightdetail.BarCode ? lightdetail.BarCode : 'Not specified' %>"
                              maxlength="60"
                              readonly
                              required
                            />
                          </div>
                        </div>

                        <!-- <div class="mb-1 row">
                          <div class="col-sm-2">
                            <label class="col-form-label new_lable" for="name">Price</label>
                          </div>
                          <div class="col-sm-10">
                            <input type="text" id="price" class="form-control" name="price" value="<%=lightdetail.price%>" maxlength="60" required>

                          </div>
                        </div> -->

                        <style>
                          .pro_img {
                            width: 120px;
                            height: 120px;
                            object-fit: cover;
                          }
                          .product_lisitng .form-control {
                            border: none;
                          }
                        </style>

                        <h4 class="card-title">Retail Stores</h4>
                        <div class="row product_lisitng">
                          <% lightdetail.product.forEach((product, index) => {
                          %>
                          <div class="col-md-4 mb-3">
                            <input
                              type="hidden"
                              name="product[<%= index %>][_id]"
                              value="<%= product._id %>"
                            />
                            <img
                              id="shopName<%= index %>"
                              src="<%= product.shopName.image %>"
                              alt="Store Image"
                              class="pro_img"
                            />
                            <div class="up_div">
                              <label
                                class="col-form-label new_lable"
                                for="shopName<%= index %>"
                                >Store Name</label
                              >
                              <input
                                type="text"
                                id="shopName<%= index %>"
                                class="form-control"
                                name="product[<%= index %>][shopName]"
                                value="<%= product.shopName.name %>"
                                readonly
                              />
                              <input
                                type="hidden"
                                name="product[<%= index %>][_id]"
                                value="<%= product._id %>"
                              />
                            </div>
                            <div class="up_div">
                              <label
                                class="col-form-label new_lable"
                                for="price<%= index %>"
                                >Price</label
                              >
                              <input
                                type="number"
                                id="price<%= index %>"
                                class="form-control"
                                name="product[<%= index %>][price]"
                                value="<%= product.price %>"
                                readonly
                              />
                              <input
                                type="hidden"
                                name="product[<%= index %>][_id]"
                                value="<%= product._id %>"
                              />
                            </div>

                            <div class="up_div">
                              <label
                                class="col-form-label new_lable"
                                for="Location<%= index %>"
                                >Location</label
                              >
                              <input
                                type="text"
                                id="Location<%= index %>"
                                class="form-control"
                                name="product[<%= index %>][Location]"
                                value="<%= product.Location %>"
                                readonly
                              />
                              <input
                                type="hidden"
                                name="product[<%= index %>][_id]"
                                value="<%= product._id %>"
                              />
                            </div>

                            <div class="up_div">
                              <label
                                class="col-form-label new_lable"
                                for="date<%= index %>"
                                >Date</label
                              >
                              <% const formattedDate = new
                              Date(product.date).toDateString(); %>
                              <input
                                type="text"
                                id="date<%= index %>"
                                class="form-control"
                                name="product[<%= index %>][date]"
                                value="<%= formattedDate %>"
                                readonly
                              />
                              <input
                                type="hidden"
                                name="product[<%= index %>][_id]"
                                value="<%= product._id %>"
                              />
                            </div>
                          </div>
                          <% }) %>
                        </div>

                        <div class="d-flex justify-content-center gap-2 mt-4">
                          <a
                            href="/ProductComment/<%=lightdetail._id%>"
                            class="btn bg-light-primary"
                            >Comments</a
                          >
                          <a
                            href="/ProductRating/<%=lightdetail._id%>"
                            class="btn bg-light-primary"
                            >Rating & Review</a
                          >
                          <a
                            href="/ProductReport/<%=lightdetail._id%>"
                            class="btn bg-light-primary"
                            >Report Product</a
                          >
                        </div>
                        <div class="row">
                          <div class="col-12 text-end">
                            <button
                              onclick="back()"
                              class="btn btn-primary waves-effect waves-float waves-light"
                            >
                              Back
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
    </div>
  </div>
  <div class="sidenav-overlay"></div>
  <div class="drag-target"></div>

  <%- include('../common/footer'); -%>
  <script>
    function back() {
      window.history.back();
    }

    setTimeout(function () {
      $("div.msg").fadeOut();
    }, 2000);
  </script>

  <script
    src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.3/jquery.validate.min.js"
    integrity="sha512-37T7leoNS06R80c8Ulq7cdCDU5MNQBwlYoy1TX/WUsLFC2eYNqtKlV0QjH7r8JpG/S0GUMZwebnVFLPd6SU5yg=="
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
  ></script>

  <script>
    $(document).ready(function () {
      jQuery.validator.addMethod(
        "noSpace",
        function (value, element) {
          return value == "" || value.trim().length != 0;
        },
        "No space allowed"
      );

      $("#profile").validate({
        rules: {
          categoryNames: {
            required: true,
            noSpace: true,
            maxlength: 60,
          },
          name: {
            required: true,
            noSpace: true,
            maxlength: 60,
          },
          price: {
            required: true,
            noSpace: true,
            maxlength: 60,
          },
        },

        errorElement: "div",
        errorClass: "jqval-error",
        errorPlacement: function (error, element) {
          error.insertAfter(element);
          error.slideDown(400);
          error.animate(
            {
              opacity: 1,
            },
            {
              queue: false,
              duration: 700,
            }
          );
        },

        submitHandler: function (form) {
          var error = $(".assign_error_div").text();
          if (!error) {
            form.submit();
          }
        },
      });
    });
  </script>

  <script>
    $(window).on("load", function () {
      if (feather) {
        feather.replace({
          width: 14,
          height: 14,
        });
      }
    });
  </script>

  <script>
    function loadFile(event, c) {
      var image = document.getElementById(c);
      image.src = URL.createObjectURL(event.target.files[0]);
    }
  </script>
</body>
